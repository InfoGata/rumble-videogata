(()=>{var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.toSeconds=e.end=e.parse=e.pattern=void 0;var t="\\d+",a="".concat(t,"(?:[\\.,]").concat(t,")?"),n="(".concat(t,"Y)?(").concat(t,"M)?(").concat(t,"W)?(").concat(t,"D)?"),i="T(".concat(a,"H)?(").concat(a,"M)?(").concat(a,"S)?"),s="P(?:".concat(n,"(?:").concat(i,")?)"),r=["years","months","weeks","days","hours","minutes","seconds"],o=Object.freeze({years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0});e.pattern=new RegExp(s);e.parse=function(t){var a=t.replace(/,/g,".").match(e.pattern);if(!a)throw new RangeError("invalid duration: ".concat(t));var n=a.slice(1);if(0===n.filter((function(e){return null!=e})).length)throw new RangeError("invalid duration: ".concat(t));if(n.filter((function(e){return/\./.test(e||"")})).length>1)throw new RangeError("only the smallest unit can be fractional");return n.reduce((function(e,t,a){return e[r[a]]=parseFloat(t||"0")||0,e}),{})};e.end=function(e,t){void 0===t&&(t=new Date);var a=Object.assign({},o,e),n=t.getTime(),i=new Date(n);i.setFullYear(i.getFullYear()+a.years),i.setMonth(i.getMonth()+a.months),i.setDate(i.getDate()+a.days);var s=36e5*a.hours,r=6e4*a.minutes;return i.setMilliseconds(i.getMilliseconds()+1e3*a.seconds+s+r),i.setDate(i.getDate()+7*a.weeks),i};e.toSeconds=function(t,a){void 0===a&&(a=new Date);var n=Object.assign({},o,t),i=a.getTime(),s=new Date(i);return((0,e.end)(n,s).getTime()-s.getTime())/1e3},e.default={end:e.end,toSeconds:e.toSeconds,pattern:e.pattern,parse:e.parse};const c=async e=>{let t=await application.getCorsProxy();t||(t="https://cloudcors.audio-pwa.workers.dev?url=");return await application.isNetworkRequestCorsDisabled()?await application.networkRequest(e):await fetch(`${t}${e}`)},l=async t=>{const a=`https://rumble.com/${t}`,n=await c(a),i=await n.text(),s=(new DOMParser).parseFromString(i,"text/html"),r=s.querySelector('script[type="application/ld+json"]'),o=JSON.parse(r?.textContent||"").filter((e=>"VideoObject"===e["@type"]))[0],l=(o.embedUrl?.toString()||"").split("/").slice(0,-1).slice(-1)[0],m=o.uploadDate?.toString(),u=o.name?.toString(),d=o.duration?.toString();let p=0;d&&(p=(0,e.toSeconds)((0,e.parse)(d)));const g=o.url?.toString(),y=o.thumbnailUrl?.toString();let h;o.interactionStatistic&&"userInteractionCount"in o.interactionStatistic&&(h=o.interactionStatistic.userInteractionCount?.valueOf());const f=s.getElementsByClassName("media-heading-name")[0].textContent||"",w=s.getElementsByClassName("media-by--a")[0].getAttribute("href")?.split("/").slice(-1)[0];return{title:u||"",channelName:f,channelApiId:w,duration:p,apiId:l,uploadDate:m,images:y?[{url:y}]:void 0,originalUrl:g,views:h}};application.onUiMessage=async e=>{switch(e.type){case"geturl":!function(e){application.postUiMessage(e)}({type:"videoid",videoId:await async function(e){return(await l(e)).apiId||""}(e.apiId)});break;case"endvideo":application.endVideo()}};const m=e=>{const t=e.getElementsByClassName("video-item--title")[0]?.textContent||"",a=e.getElementsByClassName("video-item--duration")[0]?.getAttribute("data-value"),n=function(e){for(var t=e.split(":"),a=0,n=1;t.length>0;)a+=n*parseInt(t.pop()||"0",10),n*=60;return a}(a||"0"),i=e.getElementsByClassName("video-item--img")[0]?.src,s=e.getElementsByClassName("video-item--a")[0]?.getAttribute("href")?.substring(1).split("0")[0],r=e.getElementsByClassName("video-item--by-a")[0],o=r?.textContent||"",c=r.getAttribute("href")?.split("/").slice(-1)[0];return{title:t,duration:n,apiId:s,channelName:o,channelApiId:c,images:[{url:i}]}},u=async e=>{const t=e.pageInfo?.offset||0,a=t/20+1,n=`https://rumble.com/search/videos?q=${e.query}&page=${a}`,i=await c(n),s=await i.text(),r=(new DOMParser).parseFromString(s,"text/html");return{items:Array.from(r.getElementsByClassName("video-listing-entry")).map(m),pageInfo:{resultsPerPage:20,offset:t,nextPage:a.toString()}}},d=async e=>{const t=`https://rumble.com/search/channel?q=${e.query}`,a=await c(t),n=await a.text();let i=(new DOMParser).parseFromString(n,"text/html"),s=i.styleSheets[0]?.cssRules;if(!s){const e=document.createRange().createContextualFragment(n);document.body.appendChild(e),i=document,s=i.styleSheets[0]?.cssRules}const r=Array.from(i.getElementsByClassName("video-listing-entry")),o=s&&Array.from(s).filter((e=>e instanceof CSSStyleRule)).reduce(((e,t)=>{const a=t;return e[a.selectorText]=a.style,e}),{}),l=r.map(((e,t)=>((e,t,a)=>{const n=e.getElementsByClassName("channel-item--title")[0]?.textContent||"",i=e.getElementsByClassName("channel-item--a")[0].getAttribute("href")?.split("/").slice(-1)[0];let s;if(a){const e=a[`i.user-image--img--id-${t}`];e&&(s=e.backgroundImage.slice(4,-1).replace(/"/g,""))}return{name:n,images:s?[{url:s}]:[],apiId:i}})(e,t,o)));return document.body.innerHTML="",{items:l}};application.onSearchAll=async e=>{const t=u(e),a=d(e),[n,i]=await Promise.all([t,a]);return{videos:n,channels:i}},application.onSearchVideos=u,application.onGetVideo=async e=>await l(e.apiId),application.onGetChannelVideos=async e=>{const t=e.pageInfo?.offset||0,a=t/20+1,n=`https://rumble.com/c/${e.apiId}?page=${a}`,i=await c(n),s=await i.text(),r=(new DOMParser).parseFromString(s,"text/html");return{items:Array.from(r.getElementsByClassName("video-listing-entry")).map(m),pageInfo:{resultsPerPage:20,offset:t,nextPage:a.toString()}}},application.onSearchChannels=d})();