(()=>{var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.toSeconds=e.end=e.parse=e.pattern=void 0;var t="\\d+",a="".concat(t,"(?:[\\.,]").concat(t,")?"),n="(".concat(t,"Y)?(").concat(t,"M)?(").concat(t,"W)?(").concat(t,"D)?"),s="T(".concat(a,"H)?(").concat(a,"M)?(").concat(a,"S)?"),r="P(?:".concat(n,"(?:").concat(s,")?)"),i=["years","months","weeks","days","hours","minutes","seconds"],o=Object.freeze({years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0});e.pattern=new RegExp(r);e.parse=function(t){var a=t.replace(/,/g,".").match(e.pattern);if(!a)throw new RangeError("invalid duration: ".concat(t));var n=a.slice(1);if(0===n.filter((function(e){return null!=e})).length)throw new RangeError("invalid duration: ".concat(t));if(n.filter((function(e){return/\./.test(e||"")})).length>1)throw new RangeError("only the smallest unit can be fractional");return n.reduce((function(e,t,a){return e[i[a]]=parseFloat(t||"0")||0,e}),{})};e.end=function(e,t){void 0===t&&(t=new Date);var a=Object.assign({},o,e),n=t.getTime(),s=new Date(n);s.setFullYear(s.getFullYear()+a.years),s.setMonth(s.getMonth()+a.months),s.setDate(s.getDate()+a.days);var r=36e5*a.hours,i=6e4*a.minutes;return s.setMilliseconds(s.getMilliseconds()+1e3*a.seconds+r+i),s.setDate(s.getDate()+7*a.weeks),s};e.toSeconds=function(t,a){void 0===a&&(a=new Date);var n=Object.assign({},o,t),s=a.getTime(),r=new Date(s);return((0,e.end)(n,r).getTime()-r.getTime())/1e3},e.default={end:e.end,toSeconds:e.toSeconds,pattern:e.pattern,parse:e.parse};const c=async t=>{const a=`https://rumble.com/${t}`;let n=await application.getCorsProxy();n||(n="https://cloudcors.audio-pwa.workers.dev?url=");const s=await fetch(`${n}${a}`),r=await s.text(),i=(new DOMParser).parseFromString(r,"text/html"),o=i.querySelector('script[type="application/ld+json"]'),c=JSON.parse(o?.textContent||"").filter((e=>"VideoObject"===e["@type"]))[0],l=(c.embedUrl?.toString()||"").split("/").slice(0,-1).slice(-1)[0],p=c.uploadDate?.toString(),u=c.name?.toString(),m=c.duration?.toString();let d=0;m&&(d=(0,e.toSeconds)((0,e.parse)(m)));const g=c.url?.toString(),h=c.thumbnailUrl?.toString();let y;c.interactionStatistic&&"userInteractionCount"in c.interactionStatistic&&(y=c.interactionStatistic.userInteractionCount?.valueOf());const f=i.getElementsByClassName("media-heading-name")[0].textContent||"",w=i.getElementsByClassName("media-by--a")[0].getAttribute("href")?.split("/").slice(-1)[0];return{title:u||"",channelName:f,channelApiId:w,duration:d,apiId:l,uploadDate:p,images:h?[{url:h}]:void 0,originalUrl:g,views:y}};application.onUiMessage=async e=>{switch(e.type){case"geturl":!function(e){application.postUiMessage(e)}({type:"videoid",videoId:await async function(e){return(await c(e)).apiId||""}(e.apiId)});break;case"endvideo":application.endVideo()}};const l=e=>{const t=e.getElementsByClassName("video-item--title")[0]?.textContent||"",a=e.getElementsByClassName("video-item--duration")[0]?.getAttribute("data-value"),n=function(e){for(var t=e.split(":"),a=0,n=1;t.length>0;)a+=n*parseInt(t.pop()||"0",10),n*=60;return a}(a||"0"),s=e.getElementsByClassName("video-item--img")[0]?.src,r=e.getElementsByClassName("video-item--a")[0]?.getAttribute("href")?.substring(1).split("0")[0],i=e.getElementsByClassName("video-item--by-a")[0],o=i?.textContent||"",c=i.getAttribute("href")?.split("/").slice(-1)[0];return{title:t,duration:n,apiId:r,channelName:o,channelApiId:c,images:[{url:s}]}},p=async e=>{const t=e.pageInfo?.offset||0,a=t/20+1,n=`https://rumble.com/search/videos?q=${e.query}&page=${a}`;let s=await application.getCorsProxy();s||(s="https://cloudcors.audio-pwa.workers.dev?url=");const r=await fetch(`${s}${n}`),i=await r.text(),o=(new DOMParser).parseFromString(i,"text/html");return{items:Array.from(o.getElementsByClassName("video-listing-entry")).map(l),pageInfo:{resultsPerPage:20,offset:t,nextPage:a.toString()}}},u=async e=>{const t=`https://rumble.com/search/channel?q=${e.query}`;let a=await application.getCorsProxy();a||(a="https://cloudcors.audio-pwa.workers.dev?url=");const n=await fetch(`${a}${t}`),s=await n.text(),r=(new DOMParser).parseFromString(s,"text/html"),i=Array.from(r.getElementsByClassName("video-listing-entry")),o=r.styleSheets[0].cssRules,c=Array.from(o).filter((e=>e instanceof CSSStyleRule)).reduce(((e,t)=>{const a=t;return e[a.selectorText]=a.style,e}),{}),l=i.map(((e,t)=>((e,t,a)=>{const n=e.getElementsByClassName("channel-item--title")[0]?.textContent||"",s=e.getElementsByClassName("channel-item--a")[0].getAttribute("href")?.split("/").slice(-1)[0],r=(e.getElementsByClassName("user-image--img")[0],a[`i.user-image--img--id-${t}`]);let i;return r&&(i=r.backgroundImage.slice(4,-1).replace(/"/g,"")),{name:n,images:i?[{url:i}]:[],apiId:s}})(e,t,c)));return{items:l}};application.onSearchAll=async e=>{const t=p(e),a=u(e),[n,s]=await Promise.all([t,a]);return{videos:n,channels:s}},application.onSearchVideos=p,application.onGetVideo=async e=>await c(e.apiId),application.onGetChannelVideos=async e=>{const t=e.pageInfo?.offset||0,a=t/20+1,n=`https://rumble.com/c/${e.apiId}?page=${a}`;let s=await application.getCorsProxy();s||(s="https://cloudcors.audio-pwa.workers.dev?url=");const r=await fetch(`${s}${n}`),i=await r.text(),o=(new DOMParser).parseFromString(i,"text/html");return{items:Array.from(o.getElementsByClassName("video-listing-entry")).map(l),pageInfo:{resultsPerPage:20,offset:t,nextPage:a.toString()}}},application.onSearchChannels=u})();