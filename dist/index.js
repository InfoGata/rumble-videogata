(()=>{var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.toSeconds=e.end=e.parse=e.pattern=void 0;var t="\\d+",a="".concat(t,"(?:[\\.,]").concat(t,")?"),n="(".concat(t,"Y)?(").concat(t,"M)?(").concat(t,"W)?(").concat(t,"D)?"),r="T(".concat(a,"H)?(").concat(a,"M)?(").concat(a,"S)?"),i="P(?:".concat(n,"(?:").concat(r,")?)"),s=["years","months","weeks","days","hours","minutes","seconds"],o=Object.freeze({years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0});e.pattern=new RegExp(i);e.parse=function(t){var a=t.replace(/,/g,".").match(e.pattern);if(!a)throw new RangeError("invalid duration: ".concat(t));var n=a.slice(1);if(0===n.filter((function(e){return null!=e})).length)throw new RangeError("invalid duration: ".concat(t));if(n.filter((function(e){return/\./.test(e||"")})).length>1)throw new RangeError("only the smallest unit can be fractional");return n.reduce((function(e,t,a){return e[s[a]]=parseFloat(t||"0")||0,e}),{})};e.end=function(e,t){void 0===t&&(t=new Date);var a=Object.assign({},o,e),n=t.getTime(),r=new Date(n);r.setFullYear(r.getFullYear()+a.years),r.setMonth(r.getMonth()+a.months),r.setDate(r.getDate()+a.days);var i=36e5*a.hours,s=6e4*a.minutes;return r.setMilliseconds(r.getMilliseconds()+1e3*a.seconds+i+s),r.setDate(r.getDate()+7*a.weeks),r};e.toSeconds=function(t,a){void 0===a&&(a=new Date);var n=Object.assign({},o,t),r=a.getTime(),i=new Date(r);return((0,e.end)(n,i).getTime()-i.getTime())/1e3},e.default={end:e.end,toSeconds:e.toSeconds,pattern:e.pattern,parse:e.parse};const c=async t=>{const a=`https://rumble.com/${t}`;let n=await application.getCorsProxy();n||(n="https://cloudcors.audio-pwa.workers.dev?url=");const r=await fetch(`${n}${a}`),i=await r.text(),s=(new DOMParser).parseFromString(i,"text/html"),o=s.querySelector('script[type="application/ld+json"]'),c=JSON.parse(o?.textContent||"").filter((e=>"VideoObject"===e["@type"]))[0],l=(c.embedUrl?.toString()||"").split("/").slice(0,-1).slice(-1)[0],u=c.uploadDate?.toString(),d=c.name?.toString(),m=c.duration?.toString();let p=0;m&&(p=(0,e.toSeconds)((0,e.parse)(m)));const g=c.url?.toString(),h=c.thumbnailUrl?.toString();let y;c.interactionStatistic&&"userInteractionCount"in c.interactionStatistic&&(y=c.interactionStatistic.userInteractionCount?.valueOf());const w=s.getElementsByClassName("media-heading-name")[0].textContent||"",f=s.getElementsByClassName("media-by--a")[0].getAttribute("href")?.split("/").slice(-1)[0];return{title:d||"",channelName:w,channelApiId:f,duration:p,apiId:l,uploadDate:u,images:h?[{url:h}]:void 0,originalUrl:g,views:y}};application.onUiMessage=async e=>{switch(e.type){case"geturl":!function(e){application.postUiMessage(e)}({type:"videoid",videoId:await async function(e){return(await c(e)).apiId||""}(e.apiId)});break;case"endvideo":application.endVideo()}};const l=e=>{const t=e.getElementsByClassName("video-item--title")[0]?.textContent||"",a=e.getElementsByClassName("video-item--duration")[0]?.getAttribute("data-value"),n=function(e){for(var t=e.split(":"),a=0,n=1;t.length>0;)a+=n*parseInt(t.pop()||"0",10),n*=60;return a}(a||"0"),r=e.getElementsByClassName("video-item--img")[0]?.src,i=e.getElementsByClassName("video-item--a")[0]?.getAttribute("href")?.substring(1).split("0")[0];return{title:t,duration:n,apiId:i,images:[{url:r}]}},u=async e=>{const t=`https://rumble.com/search/videos?q=${e.query}`;let a=await application.getCorsProxy();a||(a="https://cloudcors.audio-pwa.workers.dev?url=");const n=await fetch(`${a}${t}`),r=await n.text(),i=(new DOMParser).parseFromString(r,"text/html");return{items:Array.from(i.getElementsByClassName("video-listing-entry")).map(l)}},d=async e=>{const t=`https://rumble.com/search/channel?q=${e.query}`;let a=await application.getCorsProxy();a||(a="https://cloudcors.audio-pwa.workers.dev?url=");const n=await fetch(`${a}${t}`),r=await n.text(),i=(new DOMParser).parseFromString(r,"text/html"),s=Array.from(i.getElementsByClassName("video-listing-entry")),o=i.styleSheets[0].cssRules,c=Array.from(o).filter((e=>e instanceof CSSStyleRule)).reduce(((e,t)=>{const a=t;return e[a.selectorText]=a.style,e}),{}),l=s.map(((e,t)=>((e,t,a)=>{const n=e.getElementsByClassName("channel-item--title")[0]?.textContent||"",r=e.getElementsByClassName("channel-item--a")[0].getAttribute("href")?.split("/").slice(-1)[0],i=(e.getElementsByClassName("user-image--img")[0],a[`i.user-image--img--id-${t}`]);let s;return i&&(s=i.backgroundImage.slice(4,-1).replace(/"/g,"")),{name:n,images:s?[{url:s}]:[],apiId:r}})(e,t,c)));return{items:l}};application.onSearchAll=async e=>{const t=u(e),a=d(e),[n,r]=await Promise.all([t,a]);return{videos:n,channels:r}},application.onSearchVideos=u,application.onGetVideo=async e=>await c(e.apiId),application.onGetChannelVideos=async e=>{const t=`https://rumble.com/c/${e.apiId}`;let a=await application.getCorsProxy();a||(a="https://cloudcors.audio-pwa.workers.dev?url=");const n=await fetch(`${a}${t}`),r=await n.text(),i=(new DOMParser).parseFromString(r,"text/html");return{items:Array.from(i.getElementsByClassName("video-listing-entry")).map(l)}},application.onSearchChannels=d})();