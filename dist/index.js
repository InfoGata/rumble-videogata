(()=>{var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.toSeconds=e.end=e.parse=e.pattern=void 0;var t="\\d+",a="".concat(t,"(?:[\\.,]").concat(t,")?"),n="(".concat(t,"Y)?(").concat(t,"M)?(").concat(t,"W)?(").concat(t,"D)?"),s="T(".concat(a,"H)?(").concat(a,"M)?(").concat(a,"S)?"),i="P(?:".concat(n,"(?:").concat(s,")?)"),r=["years","months","weeks","days","hours","minutes","seconds"],o=Object.freeze({years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0});e.pattern=new RegExp(i);e.parse=function(t){var a=t.replace(/,/g,".").match(e.pattern);if(!a)throw new RangeError("invalid duration: ".concat(t));var n=a.slice(1);if(0===n.filter((function(e){return null!=e})).length)throw new RangeError("invalid duration: ".concat(t));if(n.filter((function(e){return/\./.test(e||"")})).length>1)throw new RangeError("only the smallest unit can be fractional");return n.reduce((function(e,t,a){return e[r[a]]=parseFloat(t||"0")||0,e}),{})};e.end=function(e,t){void 0===t&&(t=new Date);var a=Object.assign({},o,e),n=t.getTime(),s=new Date(n);s.setFullYear(s.getFullYear()+a.years),s.setMonth(s.getMonth()+a.months),s.setDate(s.getDate()+a.days);var i=36e5*a.hours,r=6e4*a.minutes;return s.setMilliseconds(s.getMilliseconds()+1e3*a.seconds+i+r),s.setDate(s.getDate()+7*a.weeks),s};e.toSeconds=function(t,a){void 0===a&&(a=new Date);var n=Object.assign({},o,t),s=a.getTime(),i=new Date(s);return((0,e.end)(n,i).getTime()-i.getTime())/1e3},e.default={end:e.end,toSeconds:e.toSeconds,pattern:e.pattern,parse:e.parse};const c=async e=>{let t=await application.getCorsProxy();t||(t="https://cloudcors.audio-pwa.workers.dev?url=");return await application.isNetworkRequestCorsDisabled()?await application.networkRequest(e):await fetch(`${t}${e}`)},l=async t=>{const a=`https://rumble.com/${t}`,n=await c(a),s=await n.text(),i=(new DOMParser).parseFromString(s,"text/html"),r=i.querySelector('script[type="application/ld+json"]'),o=JSON.parse(r?.textContent||"").filter((e=>"VideoObject"===e["@type"]))[0],l=(o.embedUrl?.toString()||"").split("/").slice(0,-1).slice(-1)[0],m=o.uploadDate?.toString(),p=o.name?.toString(),u=o.duration?.toString();let d=0;u&&(d=(0,e.toSeconds)((0,e.parse)(u)));const g=o.url?.toString(),h=o.thumbnailUrl?.toString();let y;o.interactionStatistic&&"userInteractionCount"in o.interactionStatistic&&(y=o.interactionStatistic.userInteractionCount?.valueOf());const f=i.getElementsByClassName("media-heading-name")[0].textContent||"",w=i.getElementsByClassName("media-by--a")[0].getAttribute("href")?.split("/").slice(-1)[0];return{title:p||"",channelName:f,channelApiId:w,duration:d,apiId:l,uploadDate:m,images:h?[{url:h}]:void 0,originalUrl:g,views:y}};application.onUiMessage=async e=>{switch(e.type){case"geturl":!function(e){application.postUiMessage(e)}({type:"videoid",videoId:await async function(e){return(await l(e)).apiId||""}(e.apiId)});break;case"endvideo":application.endVideo()}};const m=e=>{const t=e.getElementsByClassName("video-item--title")[0]?.textContent||"",a=e.getElementsByClassName("video-item--duration")[0]?.getAttribute("data-value"),n=function(e){for(var t=e.split(":"),a=0,n=1;t.length>0;)a+=n*parseInt(t.pop()||"0",10),n*=60;return a}(a||"0"),s=e.getElementsByClassName("video-item--img")[0]?.src,i=e.getElementsByClassName("video-item--a")[0]?.getAttribute("href")?.substring(1).split("0")[0],r=e.getElementsByClassName("video-item--by-a")[0],o=r?.textContent||"",c=r.getAttribute("href")?.split("/").slice(-1)[0];return{title:t,duration:n,apiId:i,channelName:o,channelApiId:c,images:[{url:s}]}},p=async e=>{const t=e.pageInfo?.offset||0,a=t/20+1,n=`https://rumble.com/search/videos?q=${e.query}&page=${a}`,s=await c(n),i=await s.text(),r=(new DOMParser).parseFromString(i,"text/html");return{items:Array.from(r.getElementsByClassName("video-listing-entry")).map(m),pageInfo:{resultsPerPage:20,offset:t,nextPage:a.toString()}}},u=async()=>{const e=await c("https://rumble.com/account/channel/subscriptions"),t=await e.text(),a=(new DOMParser).parseFromString(t,"text/html").getElementsByTagName("table");return{items:Array.from(a[0].getElementsByTagName("a")).filter((e=>e.href.startsWith("/c/")||new URL(e.href).pathname.startsWith("/c/"))).map((e=>({name:e.textContent??"",apiId:e.href.split("/").slice(-1)[0]})))}},d=async e=>{const t=`https://rumble.com/search/channel?q=${e.query}`,a=await c(t),n=await a.text();let s=(new DOMParser).parseFromString(n,"text/html"),i=s.styleSheets[0]?.cssRules;if(!i){const e=document.createRange().createContextualFragment(n);document.body.appendChild(e),s=document,i=s.styleSheets[0]?.cssRules}const r=Array.from(s.getElementsByClassName("video-listing-entry")),o=i&&Array.from(i).filter((e=>e instanceof CSSStyleRule)).reduce(((e,t)=>{const a=t;return e[a.selectorText]=a.style,e}),{}),l=r.map(((e,t)=>((e,t,a)=>{const n=e.getElementsByClassName("channel-item--title")[0]?.textContent||"",s=e.getElementsByClassName("channel-item--a")[0].getAttribute("href")?.split("/").slice(-1)[0];let i;if(a){const e=a[`i.user-image--img--id-${t}`];e&&(i=e.backgroundImage.slice(4,-1).replace(/"/g,""))}return{name:n,images:i?[{url:i}]:[],apiId:s}})(e,t,o)));return document.body.innerHTML="",{items:l}};application.onSearchAll=async e=>{const t=p(e),a=d(e),[n,s]=await Promise.all([t,a]);return{videos:n,channels:s}},application.onSearchVideos=p,application.onGetVideo=async e=>await l(e.apiId),application.onGetChannelVideos=async e=>{const t=e.pageInfo?.offset||0,a=t/20+1,n=`https://rumble.com/c/${e.apiId}?page=${a}`,s=await c(n),i=await s.text(),r=(new DOMParser).parseFromString(i,"text/html");return{items:Array.from(r.getElementsByClassName("video-listing-entry")).map(m),pageInfo:{resultsPerPage:20,offset:t,nextPage:a.toString()}}},application.onSearchChannels=d;const g=async()=>{await application.isLoggedIn()&&(application.onGetUserChannels=u)};application.onPostLogin=g,g()})();