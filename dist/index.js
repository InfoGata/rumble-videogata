var b={},S;function A(){return S||(S=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.toSeconds=e.end=e.parse=e.pattern=void 0;var t="\\d+",a="".concat(t,"(?:[\\.,]").concat(t,")?"),o="(".concat(t,"Y)?(").concat(t,"M)?(").concat(t,"W)?(").concat(t,"D)?"),d="T(".concat(a,"H)?(").concat(a,"M)?(").concat(a,"S)?"),g="P(?:".concat(o,"(?:").concat(d,")?)"),u=["years","months","weeks","days","hours","minutes","seconds"],l=Object.freeze({years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0});e.pattern=new RegExp(g);var s=function(n){var i=n.replace(/,/g,".").match(e.pattern);if(!i)throw new RangeError("invalid duration: ".concat(n));var r=i.slice(1);if(r.filter(function(m){return m!=null}).length===0)throw new RangeError("invalid duration: ".concat(n));if(r.filter(function(m){return/\./.test(m||"")}).length>1)throw new RangeError("only the smallest unit can be fractional");return r.reduce(function(m,c,y){return m[u[y]]=parseFloat(c||"0")||0,m},{})};e.parse=s;var p=function(n,i){i===void 0&&(i=new Date);var r=Object.assign({},l,n),m=i.getTime(),c=new Date(m);c.setFullYear(c.getFullYear()+r.years),c.setMonth(c.getMonth()+r.months),c.setDate(c.getDate()+r.days);var y=r.hours*3600*1e3,v=r.minutes*60*1e3;return c.setMilliseconds(c.getMilliseconds()+r.seconds*1e3+y+v),c.setDate(c.getDate()+r.weeks*7),c};e.end=p;var h=function(n,i){i===void 0&&(i=new Date);var r=Object.assign({},l,n),m=i.getTime(),c=new Date(m),y=(0,e.end)(r,c),v=(y.getTime()-c.getTime())/1e3;return v};e.toSeconds=h,e.default={end:e.end,toSeconds:e.toSeconds,pattern:e.pattern,parse:e.parse}}(b)),b}var C=A();const f="https://rumble.com";function B(e){for(var t=e.split(":"),a=0,o=1;t.length>0;)a+=o*parseInt(t.pop()||"0",10),o*=60;return a}function D(e){application.postUiMessage(e)}async function O(e){return(await I(e)).apiId||""}const w=async e=>{let t=await application.getCorsProxy();return t||(t="https://cloudcors.audio-pwa.workers.dev?url="),await application.isNetworkRequestCorsDisabled()?await application.networkRequest(e):await fetch(`${t}${e}`)},I=async e=>{const t=`${f}/${e}`,o=await(await w(t)).text(),g=new DOMParser().parseFromString(o,"text/html"),u=g.querySelector('script[type="application/ld+json"]'),s=JSON.parse(u?.textContent||"").filter($=>$["@type"]==="VideoObject")[0],h=(s.embedUrl?.toString()||"").split("/").slice(0,-1).slice(-1)[0],n=s.uploadDate?.toString(),i=s.name?.toString(),r=s.duration?.toString();let m=0;r&&(m=C.toSeconds(C.parse(r)));const c=s.url?.toString(),y=s.thumbnailUrl?.toString();let v;s.interactionStatistic&&"userInteractionCount"in s.interactionStatistic&&(v=s.interactionStatistic.userInteractionCount?.valueOf());const N=g.getElementsByClassName("media-heading-name")[0].textContent||"",k=g.getElementsByClassName("media-by--a")[0].getAttribute("href")?.split("/").slice(-1)[0];return{title:i||"",channelName:N,channelApiId:k,duration:m,apiId:h,uploadDate:n,images:y?[{url:y}]:void 0,originalUrl:c,views:v}},R=async e=>{const a=e.pageInfo?.offset||0,o=a/20+1,d=`${f}/c/${e.apiId}?page=${o}`,u=await(await w(d)).text(),s=new DOMParser().parseFromString(u,"text/html"),h=Array.from(s.getElementsByClassName("video-listing-entry")).map(P),n={resultsPerPage:20,offset:a,nextPage:o.toString()};return{items:h,pageInfo:n}},j=async e=>await I(e.apiId);application.onUiMessage=async e=>{switch(e.type){case"geturl":const t=await O(e.apiId);D({type:"videoid",videoId:t});break;case"endvideo":application.endVideo();break}};const P=e=>{const t=e.getElementsByClassName("video-item--title")[0]?.textContent||"",o=e.getElementsByClassName("video-item--duration")[0]?.getAttribute("data-value"),d=B(o||"0"),u=e.getElementsByClassName("video-item--img")[0]?.src,s=e.getElementsByClassName("video-item--a")[0]?.getAttribute("href")?.substring(1).split("0")[0],p=e.getElementsByClassName("video-item--by-a")[0],h=p?.textContent||"",n=p.getAttribute("href")?.split("/").slice(-1)[0];return{title:t,duration:d,apiId:s,channelName:h,channelApiId:n,images:[{url:u}]}},V=(e,t,a)=>{const o=e.getElementsByClassName("channel-item--title")[0]?.textContent||"",g=e.getElementsByClassName("channel-item--a")[0].getAttribute("href")?.split("/").slice(-1)[0],u=`i.user-image--img--id-${t}`;let l;if(a){const s=a[u];s&&(l=s.backgroundImage.slice(4,-1).replace(/"/g,""))}return{name:o,images:l?[{url:l}]:[],apiId:g}},E=async e=>{const a=e.pageInfo?.offset||0,o=a/20+1,g=`${`${f}/search/videos`}?q=${e.query}&page=${o}`,l=await(await w(g)).text(),p=new DOMParser().parseFromString(l,"text/html"),n=Array.from(p.getElementsByClassName("video-listing-entry")).map(P),i={resultsPerPage:20,offset:a,nextPage:o.toString()};return{items:n,pageInfo:i}},M=async e=>{const a=`${`${f}/search/channel`}?q=${e.query}`,d=await(await w(a)).text();let u=new DOMParser().parseFromString(d,"text/html"),l=u.styleSheets[0]?.cssRules;if(!l){const n=document.createRange().createContextualFragment(d);document.body.appendChild(n),u=document,l=u.styleSheets[0]?.cssRules}const s=Array.from(u.getElementsByClassName("video-listing-entry")),p=l&&Array.from(l).filter(n=>n instanceof CSSStyleRule).reduce((n,i)=>{const r=i;return n[r.selectorText]=r.style,n},{}),h=s.map((n,i)=>V(n,i,p));return document.body.innerHTML="",{items:h}},x=async e=>{const t=E(e),a=M(e),[o,d]=await Promise.all([t,a]);return{videos:o,channels:d}};application.onSearchAll=x;application.onSearchVideos=E;application.onGetVideo=j;application.onGetChannelVideos=R;application.onSearchChannels=M;
